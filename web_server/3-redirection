#!/usr/bin/env bash
# Installs Nginx and configures a 301 redirect for /redirect_me

# --- Installation (from Task 1) ---
sudo apt-get update -y
sudo apt-get install nginx -y
echo "Holberton School for the win!" | sudo tee /var/www/html/index.html

# --- Configuration for 301 Redirect ---
CONFIG_FILE="/etc/nginx/sites-available/default"
REDIRECT_TEXT="\\\n\tlocation /redirect_me {\n\t\treturn 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;\n\t}"

# This 'grep' command checks if the file *already* contains "/redirect_me"
if ! grep -q "/redirect_me" "$CONFIG_FILE"; then
    # If it's NOT there, 'sed' adds it.
    sudo sed -i "/server_name _;/a $REDIRECT_TEXT" "$CONFIG_FILE"
fi

# Restart nginx
sudo service nginx restart
