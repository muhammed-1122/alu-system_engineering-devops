#!/usr/bin/env bash
# Adds a specific SSH public key to the ubuntu user's authorized_keys file.

SSH_PUBLIC_KEY="ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDNdtrNGtTXe5Tp1EJQop8mOSAuRGLjJ6DW4PqX4wId/Kawz35ESampIqHSOTJmbQ8UlxdJuk0gAXKk3Ncle4safGYqM/VeDK3LN5iAJxf4kcaxNtS3eVxWBE5iF3FbIjOqwxw5Lf5sRa5yXxA8HfWidhbIG5TqKL922hPgsCGABIrXRlfZYeC0FEuPWdr6smOElSVvIXthRWp9cr685KdCI+COxlj1RdVsvIo+zunmLACF9PYdjB2s96Fn0ocD3c5SGLvDOFCyvDojSAOyE70ebIElnskKsDTGwfT4P6jh9OBzTyQEIS2jOaE5RQq4IB4DsMhvbjDSQrP0MdCLgwkN"

SSH_DIR="$HOME/.ssh"
AUTHORIZED_KEYS_FILE="$SSH_DIR/authorized_keys"

# Create the .ssh directory and ensure it has the correct permissions (700)
mkdir -p "$SSH_DIR"
chmod 700 "$SSH_DIR"

# Append the public key to authorized_keys. We use >> to avoid overwriting.
echo "$SSH_PUBLIC_KEY" >> "$AUTHORIZED_KEYS_FILE"

# Set the correct permissions for the authorized_keys file (600)
# This is crucial for SSH security!
chmod 600 "$AUTHORIZED_KEYS_FILE"
