k#!/usr/bin/env bash
# This script stops the conflicting service on port 80 and starts Nginx.

# Stop Apache2 service which is typically running on port 80
sudo service apache2 stop 2>/dev/null || true

# Disable Apache2 service to prevent it from restarting on next boot
sudo systemctl disable apache2 2>/dev/null || true

# Start Nginx service
sudo service nginx start

# --- Verification Checks ---

# Check 1: Nginx is running (process check)
if sudo pgrep -f nginx &>/dev/null; then
    echo "SUCCESS: Nginx process is running."
else
    echo "FAILURE: Nginx process is not running."
fi

# Check 2: Nginx is listening on port 80 (socket check using ss)
if sudo ss -tuln | grep -q ':80'; then
    echo "SUCCESS: Nginx is listening on port 80."
else
    echo "FAILURE: Nginx is NOT listening on port 80."
fi

# Check 3: Web stack is accessible (functional check using curl)
if curl -sI 0:80 | grep -q "200 OK"; then
    echo "SUCCESS: Server responds with 200 OK."
else
    echo "FAILURE: Server does not respond with 200 OK."
fi
