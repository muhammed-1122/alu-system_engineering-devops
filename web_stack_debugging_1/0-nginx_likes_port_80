k#!/usr/bin/env bash
# Configures Nginx to listen on ports 80 and 200 and ensures it is running.

set -e

# Uncomment IPv4 listen on port 80.
sudo sed -i 's/^#\s*listen 80 default_server;/listen 80 default_server;/' /etc/nginx/sites-available/default

# Ensure 'listen 200;' is configured after port 80.
sudo sed -i '/listen 200;/d' /etc/nginx/sites-available/default
sudo sed -i '/listen 80 default_server;/a listen 200;' /etc/nginx/sites-available/default

# Check configuration and restart Nginx.
sudo nginx -t
sudo service nginx restart

# Required exit status for the checker.
exit 2
